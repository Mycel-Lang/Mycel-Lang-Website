# Error E4002: Lockfile is out of sync with manifest

## Summary

This error occurs when the `mycel.lock` file does not match the dependencies listed in the `mycel.toml` manifest file, indicating an inconsistent state.

---

## The Problem

The `mycel.lock` file is an auto-generated file that records the exact versions and checksums of every dependency used in a project. This ensures that builds are reproducible. If you manually edit the `mycel.toml` file (e.g., to add, remove, or update a dependency), the lockfile becomes outdated.

**Scenario:**

1.  Your `mycel.toml` and `mycel.lock` are in sync.
2.  You manually edit `mycel.toml` to change a dependency version:
    ```toml
    [tool.mycel.dependencies]
    # You change the version from "1.2.0" to "1.3.0"
    mycel-utils = "1.3.0"
    ```
3.  You run `mycel-cli build` without updating the lockfile. The compiler sees that the manifest (`mycel.toml`) wants version `1.3.0`, but the lockfile (`mycel.lock`) specifies version `1.2.0`. This is an inconsistency.

## The Solution

After manually changing your `mycel.toml` file, you need to update the lockfile. This is typically done by running a specific command to resolve and update dependencies.

```sh
# This command will update mycel.lock to match mycel.toml
mycel-cli update
```

Never edit the `mycel.lock` file by hand.

---

## Detailed Explanation

The `mycel.lock` file is critical for ensuring **reproducible builds**. It guarantees that every developer on a team, as well as the CI/CD pipeline, will use the exact same version of every dependency, down to the last bit. This prevents "works on my machine" problems.

When you run a command like `mycel-cli build`, the toolchain first checks for consistency. It compares the dependencies listed in `mycel.toml` with the exact versions recorded in `mycel.lock`. If there is any discrepancy, it means the project is in an indeterminate state. The compiler doesn't know which source of truth to follow: the manifest, which reflects your desired state, or the lockfile, which reflects the last known stable state.

To avoid ambiguity and ensure reproducibility, the compiler stops and reports error `E4002`.

The correct workflow is:

1.  Modify your dependencies in `mycel.toml`.
2.  Run the `mycel-cli update` (or equivalent) command. This will resolve the new dependencies, download them if necessary, and write a brand new, consistent `mycel.lock` file.
3.  Commit both the updated `mycel.toml` and the new `mycel.lock` to version control.
