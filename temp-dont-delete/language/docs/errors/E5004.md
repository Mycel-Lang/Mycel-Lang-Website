# Error E5004: WASM module panicked during execution

## Summary

This error occurs when a function implemented in a WebAssembly (WASM) module terminates unexpectedly due to an internal, unrecoverable error, known as a "panic."

---

## The Problem

Functions in Mycel can be implemented in other languages (like Rust or Go) and compiled to WASM for safe execution. A "panic" is how these languages signal a fatal, unhandled error, such as trying to access an array index that is out of bounds or unwrapping a `null` value.

**Scenario:**

Imagine a function `@calculateAverage` written in Rust. It is designed to calculate the average of a list of numbers.

**Rust code (conceptual):**
```rust
// This code gets compiled to WASM.
fn calculate_average(numbers: Vec<f64>) -> f64 {
    // If the list is empty, this will cause a divide-by-zero panic.
    numbers.iter().sum::<f64>() / numbers.len() as f64
}
```

**Mycel code:**
```mycel
let emptyList = [];

// Calling the function with an empty list triggers the panic in the WASM module.
@calculateAverage(emptyList)
```

## The Solution

This error indicates a bug within the WASM module itself, not in your Mycel code. The solution requires debugging the source code of the WASM module.

1.  **Report the Bug:** If the function is from a third-party package, you should report the error to the package author. Include the input that caused the function to panic.
2.  **Debug the Module:** If you are the author of the WASM module, you need to add better error handling to your source code to prevent the panic. For example, you should check for edge cases like empty lists or invalid input.

**Rust code (Fixed):**
```rust
fn calculate_average(numbers: Vec<f64>) -> f64 {
    // Add a check to prevent the panic.
    if numbers.is_empty() {
        return 0.0;
    }
    numbers.iter().sum::<f64>() / numbers.len() as f64
}
```

---

## Detailed Explanation

The Mycel compiler runs WASM modules in a sandbox for security. However, it cannot prevent the code inside the module from having bugs. A panic is the WASM module's way of saying, "I have encountered a situation I don't know how to handle, and I must shut down."

The Mycel compiler catches this shutdown signal and reports it to you as error `E5004`. This is more user-friendly than the program simply crashing. The error message will often include the original panic message from the WASM module, which can be very helpful for debugging (e.g., "panic: division by zero").

When you see this error, it is important to understand that the problem is not with your Mycel syntax or logic, but with the internal logic of the function you are calling. Your Mycel code is valid, but it has provided input that triggers a bug in the underlying WASM code.

Your responsibility as the user is to report this bug to the function's author with a clear, minimal example of the input that caused the failure. If you are the author, you must add checks and error handling to your Rust, Go, or other source language to handle the edge case gracefully instead of panicking.
